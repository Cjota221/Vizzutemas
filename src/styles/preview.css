/* =====================================================
   VIZZUTEMAS - PREVIEW CSS
   Sistema de Estilos para Renderização no Iframe
   
   Este arquivo é carregado APENAS no preview/embed
   para garantir consistência visual independente do
   viewport e das classes dinâmicas dos widgets.
   ===================================================== */

/* =====================================================
   1. FLUID TYPOGRAPHY SYSTEM
   Fontes que escalam suavemente entre mobile (430px) 
   e desktop (1400px) usando clamp()
   ===================================================== */

:root {
  /* Base size: 14px no mobile → 16px no desktop */
  --base-font-size: clamp(14px, 0.875rem + 0.25vw, 16px);
  
  /* Scale ratio para títulos */
  --scale-ratio: 1.2;
  
  /* Font sizes fluidos */
  --text-xs: clamp(0.65rem, 0.6rem + 0.25vw, 0.75rem);       /* 10-12px */
  --text-sm: clamp(0.75rem, 0.7rem + 0.3vw, 0.875rem);       /* 12-14px */
  --text-base: clamp(0.875rem, 0.8rem + 0.4vw, 1rem);        /* 14-16px */
  --text-lg: clamp(1rem, 0.9rem + 0.5vw, 1.125rem);          /* 16-18px */
  --text-xl: clamp(1.125rem, 1rem + 0.625vw, 1.25rem);       /* 18-20px */
  --text-2xl: clamp(1.25rem, 1.1rem + 0.75vw, 1.5rem);       /* 20-24px */
  --text-3xl: clamp(1.5rem, 1.25rem + 1.25vw, 2rem);         /* 24-32px */
  --text-4xl: clamp(2rem, 1.5rem + 2.5vw, 2.5rem);           /* 32-40px */
  --text-5xl: clamp(2.5rem, 2rem + 2.5vw, 3rem);             /* 40-48px */
  
  /* Spacing fluido */
  --space-1: clamp(0.25rem, 0.2rem + 0.25vw, 0.375rem);      /* 4-6px */
  --space-2: clamp(0.5rem, 0.4rem + 0.5vw, 0.75rem);         /* 8-12px */
  --space-3: clamp(0.75rem, 0.6rem + 0.75vw, 1rem);          /* 12-16px */
  --space-4: clamp(1rem, 0.8rem + 1vw, 1.5rem);              /* 16-24px */
  --space-6: clamp(1.5rem, 1.2rem + 1.5vw, 2rem);            /* 24-32px */
  --space-8: clamp(2rem, 1.5rem + 2.5vw, 3rem);              /* 32-48px */
  --space-12: clamp(3rem, 2rem + 5vw, 5rem);                 /* 48-80px */
  
  /* Container widths */
  --container-xs: 20rem;   /* 320px */
  --container-sm: 24rem;   /* 384px */
  --container-md: 28rem;   /* 448px */
  --container-lg: 32rem;   /* 512px */
  --container-xl: 36rem;   /* 576px */
  --container-2xl: 42rem;  /* 672px */
  --container-3xl: 48rem;  /* 768px */
  --container-4xl: 56rem;  /* 896px */
  --container-5xl: 64rem;  /* 1024px */
  --container-6xl: 72rem;  /* 1152px */
  --container-7xl: 80rem;  /* 1280px */
  
  /* Preview Theme Variables (defaults - serão sobrescritos pelo tema) */
  --preview-font-title: 'Poppins', -apple-system, BlinkMacSystemFont, sans-serif;
  --preview-font-body: 'Poppins', -apple-system, BlinkMacSystemFont, sans-serif;
  --preview-color-primary: #e94560;
  --preview-color-secondary: #1a1a2e;
  --preview-color-accent: #e94560;
  --preview-color-background: #ffffff;
  --preview-color-text: #333333;
  --preview-color-text-muted: #6b7280;
}

/* =====================================================
   2. BASE RESET PARA PREVIEW
   Garantir consistência visual no iframe
   ===================================================== */

/* Aplicar font-size base ao HTML */
html {
  font-size: var(--base-font-size);
  scroll-behavior: smooth;
  -webkit-text-size-adjust: 100%;
  text-size-adjust: 100%;
}

/* Reset do body para preview */
body.preview-body {
  margin: 0;
  padding: 0;
  font-family: var(--preview-font-body);
  font-size: 1rem;
  line-height: 1.5;
  color: var(--preview-color-text);
  background-color: var(--preview-color-background);
  overflow-x: hidden;
  overflow-y: auto;
  min-height: 100%;
  -webkit-font-smoothing: antialiased;
  -moz-osx-font-smoothing: grayscale;
}

/* =====================================================
   3. IMAGE & MEDIA CONTAINMENT
   Impedir que imagens e vídeos estourem o layout
   ===================================================== */

/* Reset de imagens - CRÍTICO para widgets */
img,
picture,
video,
canvas,
svg {
  display: block;
  max-width: 100% !important;
  height: auto;
}

/* Imagens dentro de widgets */
.widget img,
.widget picture,
.widget video {
  max-width: 100% !important;
  width: auto;
  height: auto;
  object-fit: cover;
}

/* Forçar aspect ratio em imagens de produto */
.widget img[src*="product"],
.widget img[src*="banner"],
.product-image,
.banner-image {
  width: 100%;
  height: auto;
  object-fit: cover;
}

/* Iframes responsivos */
iframe {
  max-width: 100% !important;
  border: 0;
}

/* Iframe de vídeo com aspect ratio 16:9 */
.widget iframe[src*="youtube"],
.widget iframe[src*="vimeo"],
.widget iframe[src*="player"],
.video-wrapper iframe {
  aspect-ratio: 16 / 9;
  width: 100% !important;
  height: auto !important;
}

/* Wrapper para vídeos */
.video-wrapper,
.video-container {
  position: relative;
  width: 100%;
  padding-bottom: 56.25%; /* 16:9 */
  height: 0;
  overflow: hidden;
}

.video-wrapper iframe,
.video-container iframe {
  position: absolute;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
}

/* =====================================================
   4. TYPOGRAPHY CLASSES FLUIDAS
   Classes utilitárias para tipografia responsiva
   ===================================================== */

/* Títulos com escala fluida */
.preview-h1,
h1.fluid {
  font-family: var(--preview-font-title);
  font-size: var(--text-4xl);
  font-weight: 700;
  line-height: 1.1;
  letter-spacing: -0.025em;
}

.preview-h2,
h2.fluid {
  font-family: var(--preview-font-title);
  font-size: var(--text-3xl);
  font-weight: 600;
  line-height: 1.2;
  letter-spacing: -0.02em;
}

.preview-h3,
h3.fluid {
  font-family: var(--preview-font-title);
  font-size: var(--text-2xl);
  font-weight: 600;
  line-height: 1.25;
}

.preview-h4,
h4.fluid {
  font-family: var(--preview-font-title);
  font-size: var(--text-xl);
  font-weight: 600;
  line-height: 1.3;
}

.preview-h5,
h5.fluid {
  font-family: var(--preview-font-title);
  font-size: var(--text-lg);
  font-weight: 600;
  line-height: 1.4;
}

.preview-h6,
h6.fluid {
  font-family: var(--preview-font-title);
  font-size: var(--text-base);
  font-weight: 600;
  line-height: 1.4;
}

/* Parágrafos fluidos */
.preview-p,
p.fluid {
  font-size: var(--text-base);
  line-height: 1.6;
  margin-bottom: var(--space-4);
}

.preview-p-lg,
p.fluid-lg {
  font-size: var(--text-lg);
  line-height: 1.7;
}

.preview-p-sm,
p.fluid-sm {
  font-size: var(--text-sm);
  line-height: 1.5;
}

/* Texto pequeno (labels, captions) */
.preview-small,
small.fluid {
  font-size: var(--text-xs);
  line-height: 1.4;
}

/* =====================================================
   5. WIDGET CONTAINER SYSTEM
   Isolamento e contenção de widgets injetados
   ===================================================== */

/* Container principal de widgets */
.widgets-section {
  display: flex;
  flex-direction: column;
  gap: 0;
  width: 100%;
  position: relative;
  z-index: 1;
}

/* Cada widget é um bloco isolado */
.widget {
  position: relative;
  isolation: isolate;
  contain: layout style paint;
  display: block;
  width: 100%;
  max-width: 100%;
  overflow: hidden;
  z-index: 1;
  /* Criar novo contexto de stacking */
  transform: translateZ(0);
}

/* Herdar variáveis de cor do tema */
.widget-container {
  /* Estas variáveis são injetadas dinamicamente pelo WidgetRenderer */
  --cor-primaria: var(--preview-color-primary);
  --cor-secundaria: var(--preview-color-secondary);
  --cor-destaque: var(--preview-color-accent);
  --cor-fundo: var(--preview-color-background);
  --cor-texto: var(--preview-color-text);
  
  /* Fontes do tema */
  font-family: var(--preview-font-body);
}

/* Widget com erro - fallback visual */
.widget-error {
  padding: var(--space-4);
  margin: var(--space-2) 0;
  background-color: #fef2f2;
  border: 1px solid #fecaca;
  border-radius: 8px;
  color: #b91c1c;
  font-size: var(--text-sm);
}

.widget-error-title {
  font-weight: 600;
  margin-bottom: var(--space-1);
}

.widget-error-message {
  font-size: var(--text-xs);
  opacity: 0.8;
}

/* =====================================================
   6. OVERRIDE DE ESTILOS PERIGOSOS DOS WIDGETS
   Widgets de terceiros frequentemente usam estilos
   que quebram o layout global. Anulamos aqui.
   ===================================================== */

/* Anular position fixed dentro de widgets */
.widget [style*="position: fixed"],
.widget [style*="position:fixed"] {
  position: relative !important;
}

/* Anular position sticky que causa problemas */
.widget [style*="position: sticky"],
.widget [style*="position:sticky"] {
  position: relative !important;
}

/* Anular z-index absurdos */
.widget * {
  z-index: auto;
}

/* Exceções para elementos que precisam de z-index dentro do widget */
.widget .swiper-button-next,
.widget .swiper-button-prev,
.widget .swiper-pagination,
.widget [class*="nav"],
.widget [class*="arrow"],
.widget [class*="btn"],
.widget button {
  z-index: 10;
}

/* Modals e overlays dentro do widget */
.widget [class*="modal"],
.widget [class*="overlay"],
.widget [class*="popup"],
.widget [class*="dropdown"] {
  z-index: 50;
}

/* Forçar altura automática em containers */
.widget > div,
.widget > section,
.widget > article {
  position: relative;
  height: auto;
  min-height: auto;
  max-height: none;
  overflow: visible;
}

/* Anular width:100vw que estoura o container */
.widget [style*="width: 100vw"],
.widget [style*="width:100vw"] {
  width: 100% !important;
}

/* Anular margin negativo excessivo */
.widget [style*="margin-left: -"] {
  margin-left: 0 !important;
}

.widget [style*="margin-right: -"] {
  margin-right: 0 !important;
}

/* =====================================================
   7. CARROSSEL & SLIDER FIXES
   Ajustes para Swiper, Slick e outros carrosséis
   ===================================================== */

/* Swiper/Slick container fix */
.widget .swiper,
.widget .slick-slider,
.widget .splide,
.widget [class*="carousel"],
.widget [class*="slider"] {
  max-width: 100% !important;
  overflow: hidden !important;
}

/* Swiper slides */
.widget .swiper-slide {
  width: auto;
  flex-shrink: 0;
}

/* Esconder scrollbar em carrosséis horizontais */
.widget .swiper-wrapper,
.widget .slick-track,
.widget [class*="carousel-track"] {
  -ms-overflow-style: none;
  scrollbar-width: none;
}

.widget .swiper-wrapper::-webkit-scrollbar,
.widget .slick-track::-webkit-scrollbar {
  display: none;
}

/* =====================================================
   8. RESPONSIVIDADE DO PREVIEW
   Media queries específicas para o preview no iframe
   ===================================================== */

/* Mobile First - Base styles são para mobile */

/* Tablet (768px+) */
@media (min-width: 768px) {
  :root {
    --base-font-size: clamp(15px, 0.9rem + 0.25vw, 16px);
  }
  
  .widget .grid-cols-1 {
    grid-template-columns: repeat(2, minmax(0, 1fr));
  }
}

/* Desktop (1024px+) */
@media (min-width: 1024px) {
  :root {
    --base-font-size: 16px;
  }
  
  .widget .grid-cols-1 {
    grid-template-columns: repeat(3, minmax(0, 1fr));
  }
  
  .widget .lg\:grid-cols-4 {
    grid-template-columns: repeat(4, minmax(0, 1fr));
  }
}

/* Large Desktop (1280px+) */
@media (min-width: 1280px) {
  .widget .xl\:grid-cols-5 {
    grid-template-columns: repeat(5, minmax(0, 1fr));
  }
}

/* Mobile específico (430px - iPhone 14 Pro Max) */
@media (max-width: 430px) {
  :root {
    --base-font-size: 14px;
  }
  
  /* Reduzir padding em mobile */
  .widget {
    padding-left: var(--space-2);
    padding-right: var(--space-2);
  }
  
  /* Grids em coluna única */
  .widget .grid,
  .widget [class*="grid-cols-"] {
    grid-template-columns: 1fr !important;
  }
  
  /* Flexbox wrap em mobile */
  .widget .flex {
    flex-wrap: wrap;
  }
}

/* =====================================================
   9. UTILITY CLASSES PARA WIDGETS
   Classes auxiliares que podem ser usadas nos widgets
   ===================================================== */

/* Container centralizado */
.preview-container {
  width: 100%;
  max-width: var(--container-7xl);
  margin-left: auto;
  margin-right: auto;
  padding-left: var(--space-4);
  padding-right: var(--space-4);
}

/* Seção com padding vertical */
.preview-section {
  padding-top: var(--space-8);
  padding-bottom: var(--space-8);
}

/* Grid responsivo de produtos */
.preview-product-grid {
  display: grid;
  grid-template-columns: repeat(2, minmax(0, 1fr));
  gap: var(--space-4);
}

@media (min-width: 768px) {
  .preview-product-grid {
    grid-template-columns: repeat(3, minmax(0, 1fr));
  }
}

@media (min-width: 1024px) {
  .preview-product-grid {
    grid-template-columns: repeat(4, minmax(0, 1fr));
  }
}

/* Truncate text */
.preview-truncate {
  overflow: hidden;
  text-overflow: ellipsis;
  white-space: nowrap;
}

.preview-line-clamp-2 {
  display: -webkit-box;
  -webkit-line-clamp: 2;
  -webkit-box-orient: vertical;
  overflow: hidden;
}

.preview-line-clamp-3 {
  display: -webkit-box;
  -webkit-line-clamp: 3;
  -webkit-box-orient: vertical;
  overflow: hidden;
}

/* =====================================================
   10. SCROLLBAR STYLING
   Scrollbar consistente no preview
   ===================================================== */

/* Scrollbar para o preview */
.preview-body::-webkit-scrollbar {
  width: 8px;
  height: 8px;
}

.preview-body::-webkit-scrollbar-track {
  background: #f1f1f1;
}

.preview-body::-webkit-scrollbar-thumb {
  background: #c1c1c1;
  border-radius: 4px;
}

.preview-body::-webkit-scrollbar-thumb:hover {
  background: #a1a1a1;
}

/* Esconder scrollbar horizontal (nunca deve haver) */
.preview-body {
  overflow-x: hidden !important;
}

/* =====================================================
   11. PRINT STYLES (caso alguém imprima o preview)
   ===================================================== */

@media print {
  .widget {
    break-inside: avoid;
    page-break-inside: avoid;
  }
  
  .no-print {
    display: none !important;
  }
}
